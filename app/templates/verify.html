{% extends "base.html" %}

{% block content %}
<article class="max-w-4xl mx-auto px-8 py-24">
    <h1 class="text-4xl font-medium mb-8 text-graphite-900">Verify Post Edition</h1>
    
    <div class="prose prose-lg text-graphite-700 leading-relaxed mb-12">
        <p>
            Every blog post on this site is cryptographically sealed. Each edition includes a SHA-256 hash, 
            GPG signature, Danish QTSP timestamp, and IPFS pin. This page lets you verify the authenticity 
            and publish time of any post.
        </p>
    </div>
    
    {% if error %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
        <p class="text-red-700 font-medium">{{ error }}</p>
    </div>
    {% endif %}
    
    {% if verification %}
    <!-- Verification Results -->
    <div class="border-2 {% if verification.overall_status == 'verified' %}border-green-500 bg-green-50{% elif verification.overall_status == 'tampered' %}border-red-500 bg-red-50{% else %}border-yellow-500 bg-yellow-50{% endif %} rounded-xl p-8 mb-12">
        <div class="flex items-center mb-6">
            {% if verification.overall_status == 'verified' %}
            <svg class="w-12 h-12 text-green-600 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <h2 class="text-2xl font-bold text-green-900">✓ Verified</h2>
                <p class="text-green-700">This edition is authentic and unmodified.</p>
            </div>
            {% elif verification.overall_status == 'tampered' %}
            <svg class="w-12 h-12 text-red-600 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <h2 class="text-2xl font-bold text-red-900">✗ Tampered</h2>
                <p class="text-red-700">Content hash mismatch—this edition has been modified.</p>
            </div>
            {% else %}
            <div>
                <h2 class="text-2xl font-bold text-yellow-900">⚠ Partial Verification</h2>
                <p class="text-yellow-700">Some proofs could not be verified.</p>
            </div>
            {% endif %}
        </div>
        
        <div class="space-y-4 text-sm font-mono">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <p class="text-graphite-600 mb-1">Hash Verification</p>
                    <p class="font-semibold">{{ '✓ Valid' if verification.hash_valid else '✗ Invalid' }}</p>
                </div>
                <div>
                    <p class="text-graphite-600 mb-1">Signature</p>
                    <p class="font-semibold">{{ '✓ Valid' if verification.signature_valid == True else ('✗ Invalid' if verification.signature_valid == False else '− Not checked') }}</p>
                </div>
                <div>
                    <p class="text-graphite-600 mb-1">QTSP Timestamp</p>
                    <p class="font-semibold">{{ '✓ Valid' if verification.qtsp_valid == True else ('✗ Invalid' if verification.qtsp_valid == False else '− Not checked') }}</p>
                </div>
                <div>
                    <p class="text-graphite-600 mb-1">IPFS Retrievable</p>
                    <p class="font-semibold">{{ '✓ Yes' if verification.ipfs_retrievable == True else ('✗ No' if verification.ipfs_retrievable == False else '− Not checked') }}</p>
                </div>
            </div>
            
            <div class="border-t border-graphite-300 pt-4 mt-4">
                <p class="text-graphite-600 mb-2">Content Hash (SHA-256)</p>
                <p class="break-all bg-white px-3 py-2 rounded border border-graphite-200">
                    {{ verification.details.computed_hash }}
                </p>
            </div>
        </div>
    </div>
    
    <div class="mb-12">
        <h3 class="text-xl font-medium mb-4 text-graphite-900">Post Information</h3>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <dt class="text-sm text-graphite-500">Title</dt>
                <dd class="font-medium text-graphite-900">{{ post.title }}</dd>
            </div>
            <div>
                <dt class="text-sm text-graphite-500">Edition Number</dt>
                <dd class="font-medium text-graphite-900">{{ edition.edition_number }}</dd>
            </div>
            <div>
                <dt class="text-sm text-graphite-500">Published</dt>
                <dd class="font-medium text-graphite-900">{{ edition.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</dd>
            </div>
            {% if edition.ipfs_cid %}
            <div>
                <dt class="text-sm text-graphite-500">IPFS CID</dt>
                <dd class="font-mono text-sm text-graphite-900">{{ edition.ipfs_cid }}</dd>
            </div>
            {% endif %}
        </dl>
    </div>
    {% endif %}
    
    <!-- Verification Form -->
    <div class="bg-graphite-50 rounded-xl p-8">
        <h2 class="text-2xl font-medium mb-6 text-graphite-900">Verify a Post Edition</h2>
        
        <form method="post" action="/verify" class="space-y-6">
            <div>
                <label for="slug" class="block text-sm font-medium text-graphite-700 mb-2">
                    Post Slug
                </label>
                <input 
                    type="text" 
                    id="slug" 
                    name="slug" 
                    required
                    placeholder="e.g., context-as-key-differentiator"
                    class="w-full px-4 py-3 border border-graphite-300 rounded-lg focus:outline-none focus:border-electric-blue"
                >
                <p class="text-sm text-graphite-500 mt-1">The URL slug of the blog post</p>
            </div>
            
            <div>
                <label for="edition_number" class="block text-sm font-medium text-graphite-700 mb-2">
                    Edition Number
                </label>
                <input 
                    type="number" 
                    id="edition_number" 
                    name="edition_number" 
                    required
                    min="1"
                    value="1"
                    class="w-full px-4 py-3 border border-graphite-300 rounded-lg focus:outline-none focus:border-electric-blue"
                >
                <p class="text-sm text-graphite-500 mt-1">Usually 1 for the first published version</p>
            </div>
            
            <button 
                type="submit"
                class="w-full md:w-auto px-8 py-3 bg-electric-blue text-white rounded-lg font-medium hover:opacity-90 min-w-[44px] min-h-[44px]"
            >
                Verify Edition
            </button>
        </form>
    </div>
    
    <!-- How it Works -->
    <div class="mt-16 pt-16 border-t border-graphite-200">
        <h2 class="text-2xl font-medium mb-6 text-graphite-900">How Verification Works</h2>
        
        <div class="space-y-6 text-graphite-700">
            <div>
                <h3 class="font-medium text-graphite-900 mb-2">1. Content Hash (SHA-256)</h3>
                <p>Every edition is hashed. If the content changes even slightly, the hash will not match.</p>
            </div>
            
            <div>
                <h3 class="font-medium text-graphite-900 mb-2">2. GPG Signature</h3>
                <p>The hash is signed with my hardware-backed GPG key (YubiKey). This proves authorship.</p>
            </div>
            
            <div>
                <h3 class="font-medium text-graphite-900 mb-2">3. Danish QTSP Timestamp (.tsr)</h3>
                <p>A qualified timestamp from a Danish eIDAS provider proves the exact publish time—court-admissible.</p>
            </div>
            
            <div>
                <h3 class="font-medium text-graphite-900 mb-2">4. OpenTimestamps (Optional)</h3>
                <p>The hash is anchored to the Bitcoin blockchain for decentralized, immutable timeproofing.</p>
            </div>
            
            <div>
                <h3 class="font-medium text-graphite-900 mb-2">5. IPFS Pinning</h3>
                <p>The full edition bundle is stored on IPFS, ensuring it remains retrievable indefinitely.</p>
            </div>
        </div>
    </div>
</article>
{% endblock %}

